!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@nomadreservations/ngx-stripe",["exports","@angular/core","@angular/common","rxjs","rxjs/operators"],t):t(((e=e||self).nomadreservations=e.nomadreservations||{},e.nomadreservations["ngx-stripe"]={}),e.ng.core,e.ng.common,e.rxjs,e.rxjs.operators)}(this,(function(e,t,n,r,o){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function s(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var p=e.length-1;p>=0;p--)(o=e[p])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}function p(e,t){return function(n,r){t(n,r,e)}}function a(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function c(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function u(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function l(e){return"type"in e}var d=new t.InjectionToken("Stripe Publishable Key"),f=new t.InjectionToken("Stripe Options");function m(e){return"bank_account"===e}function y(e){return"country"in e&&"currency"in e&&"routing_number"in e&&"account_number"in e&&"account_holder_name"in e&&"account_holder_type"in e&&("individual"===e.account_holder_type||"company"===e.account_holder_type)}function h(e){return"pii"===e}function g(e){return"personal_id_number"in e}var v=function(){function e(e){this.platformId=e}return Object.defineProperty(e.prototype,"isBrowser",{get:function(){return n.isPlatformBrowser(this.platformId)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isServer",{get:function(){return n.isPlatformServer(this.platformId)},enumerable:!0,configurable:!0}),e.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[t.PLATFORM_ID]}]}]},e=s([t.Injectable(),p(0,t.Inject(t.PLATFORM_ID)),a("design:paramtypes",[Object])],e)}(),b=function(){function e(e){this._platform=e}return e.prototype.getNativeDocument=function(){return this._platform.isBrowser?document:{}},e.ctorParameters=function(){return[{type:v}]},e=s([t.Injectable(),a("design:paramtypes",[v])],e)}(),O=function(){function e(e){this._platform=e}return e.prototype.getNativeWindow=function(){return this._platform.isBrowser?window:{}},e.ctorParameters=function(){return[{type:v}]},e=s([t.Injectable(),a("design:paramtypes",[v])],e)}(),j=function(){function e(e,t,n){this.window=e,this.document=t,this._platform=n,this.status=new r.BehaviorSubject({error:!1,loaded:!1,loading:!1})}return e.prototype.asStream=function(){return this.load(),this.status.asObservable()},e.prototype.isReady=function(){return this.status.getValue().loaded},e.prototype.load=function(){var e=this;if(!this._platform.isServer)if(this.window.getNativeWindow().hasOwnProperty("Stripe"))this.status.next({error:!1,loaded:!0,loading:!1});else if(!this.status.getValue().loaded&&!this.status.getValue().loading){this.status.next(i({},this.status.getValue(),{loading:!0}));var t=this.document.getNativeDocument().createElement("script");t.type="text/javascript",t.async=!0,t.defer=!0,t.src="https://js.stripe.com/v3/",t.onload=function(){e.status.next({error:!1,loaded:!0,loading:!1})},t.onerror=function(){e.status.next({error:!0,loaded:!1,loading:!1})},this.document.getNativeDocument().body.appendChild(t)}},e.ctorParameters=function(){return[{type:O},{type:b},{type:v}]},e=s([t.Injectable(),a("design:paramtypes",[O,b,v])],e)}(),S=function(){function e(e,t,n,i,s){this.key=e,this.options=t,this.loader=n,this.window=i,this._platform=s,this.stripeChanged$=new r.ReplaySubject,this.stripe={},this.changeKey(this.key,this.options).pipe(o.take(1)).subscribe((function(){}))}return e.prototype.changeKey=function(e,t){var n=this,r=this.loader.asStream().pipe(o.filter((function(e){return!0===e.loaded})),o.map((function(){if(n.window.getNativeWindow()){var r=n.window.getNativeWindow().Stripe;return e&&(n.stripe=t?r(e,t):r(e),n.stripeChanged$.next(n.stripe)),n.stripe}})),o.publishLast(),o.refCount());return r.subscribe(),r},e.prototype.elements=function(e){var t=this;return this.stripeChanged$.pipe(o.map((function(){return t.stripe.elements(e)})))},e.prototype.createToken=function(e,t){return m(e)&&y(t)?r.from(this.stripe.createToken(e,t)):(h(e)&&g(t),r.from(this.stripe.createToken(e,t)))},e.prototype.paymentRequest=function(e){var t=this;return this.stripeChanged$.pipe(o.map((function(){return t.stripe.paymentRequest(e)})))},e.prototype.handleCardSetup=function(e,t,n){return r.from(this.stripe.handleCardSetup(e,t,n))},e.prototype.handleCardPayment=function(e,t,n){return r.from(this.stripe.handleCardPayment(e,t,n))},e.prototype.handleCardAction=function(e){return r.from(this.stripe.handleCardAction(e))},e.prototype.confirmPaymentIntent=function(e,t,n){return r.from(this.stripe.confirmPaymentIntent(e,t,n))},e.prototype.confirmCardPayment=function(e,t,n){return r.from(this.stripe.confirmCardPayment(e,t,n))},e.prototype.retrievePaymentIntent=function(e){return r.from(this.stripe.retrievePaymentIntent(e))},e.prototype.retrieveSetupIntent=function(e){return r.from(this.stripe.retrieveSetupIntent(e))},e.prototype.confirmSetupIntent=function(e,t,n){return r.from(this.stripe.confirmSetupIntent(e,t,n))},e.prototype.createSource=function(e,t){return l(e)?r.from(this.stripe.createSource(e)):r.from(this.stripe.createSource(e,t))},e.prototype.retrieveSource=function(e){return r.from(this.stripe.retrieveSource(e))},e.prototype.createPaymentMethod=function(e){return r.from(this.stripe.createPaymentMethod(e))},e.ctorParameters=function(){return[{type:String,decorators:[{type:t.Inject,args:[d]}]},{type:void 0,decorators:[{type:t.Inject,args:[f]}]},{type:j},{type:O},{type:v}]},e=s([t.Injectable(),p(0,t.Inject(d)),p(1,t.Inject(f)),a("design:paramtypes",[String,Object,j,O,v])],e)}(),w=function(){function e(e){this.stripeService=e,this.change=new t.EventEmitter,this.shippingAddressChange=new t.EventEmitter,this.shippingOptionChange=new t.EventEmitter,this.cancel=new t.EventEmitter,this.hide=!1,this.styles$=new r.BehaviorSubject({}),this.options$=new r.ReplaySubject,this.elementsOptions$=new r.BehaviorSubject({}),this.complete$=new r.Subject,this._attached=!1,this._opened=!1}return Object.defineProperty(e.prototype,"options",{set:function(e){this.options$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elementsOptions",{set:function(e){this.elementsOptions$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"styles",{set:function(e){this.styles$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"complete",{set:function(e){this.complete$.next(e)},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var e=this;this.elements$=this.elementsOptions$.asObservable().pipe(o.switchMap((function(t){return e.stripeService.elements(t)}))),this.request$=this.options$.asObservable().pipe(o.switchMap((function(t){return e.stripeService.paymentRequest(t)}))),this.complete$.subscribe((function(t){e.lastEvent&&(t?e.lastEvent.complete("success"):e.lastEvent.complete("fail"))}))},e.prototype.ngAfterViewInit=function(){var e=this;r.combineLatest(this.request$,this.elements$,this.options$,this.styles$).subscribe((function(t){var n=u(t,4),r=n[0],o=n[1],s=n[2],p=n[3];if(e.requestButton&&!e._attached){e._paymentRequest=r,e._attached=!0;var a=o.create("paymentRequestButton",{paymentRequest:r,style:{paymentRequestButton:i({},p)}});e.hide=!1,r.canMakePayment().then((function(t){t?a.mount(e.requestButton.nativeElement):e.hide=!0})),r.on("shippingaddresschange",(function(t){e.shippingAddressChange.emit(t)})),r.on("shippingoptionchange",(function(t){e.shippingOptionChange.emit(t)})),r.on("token",(function(t){e.change.emit(t),e._opened=!1})),r.on("paymentmethod",(function(t){e.change.emit(t)})),r.on("source",(function(t){e.change.emit(t)})),r.on("cancel",(function(t){e.cancel.emit(t),e._opened=!1})),r.on("click",(function(){e._opened=!0}))}else e._attached&&!e._opened&&e._paymentRequest.update({currency:s.currency,total:s.total,displayItems:s.displayItems,shippingOptions:s.shippingOptions})}))},e.ctorParameters=function(){return[{type:S}]},s([t.Input(),a("design:type",Object),a("design:paramtypes",[Object])],e.prototype,"options",null),s([t.Input(),a("design:type",Object),a("design:paramtypes",[Object])],e.prototype,"elementsOptions",null),s([t.Input(),a("design:type",Object),a("design:paramtypes",[Object])],e.prototype,"styles",null),s([t.Input(),a("design:type",Boolean),a("design:paramtypes",[Boolean])],e.prototype,"complete",null),s([t.Output(),a("design:type",Object)],e.prototype,"change",void 0),s([t.Output(),a("design:type",Object)],e.prototype,"shippingAddressChange",void 0),s([t.Output(),a("design:type",Object)],e.prototype,"shippingOptionChange",void 0),s([t.Output(),a("design:type",Object)],e.prototype,"cancel",void 0),s([t.ViewChild("request",{static:!1}),a("design:type",t.ElementRef)],e.prototype,"requestButton",void 0),e=s([t.Component({selector:"ngx-payment-request",template:'<div #request [style.display-none]="hide"></div>'}),a("design:paramtypes",[S])],e)}(),P=function(){function e(e){this.stripeService=e,this.change=new t.EventEmitter,this.complete=new t.EventEmitter,this.error=new t.EventEmitter,this.elementTypes=["card"],this.options$=new r.BehaviorSubject({}),this.elementsOptions$=new r.BehaviorSubject({})}return Object.defineProperty(e.prototype,"options",{set:function(e){this.options$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elementsOptions",{set:function(e){this.elementsOptions$.next(e)},enumerable:!0,configurable:!0}),e.prototype.ngAfterViewInit=function(){var e=this,t=this.elementsOptions$.asObservable().pipe(o.switchMap((function(t){return Object.keys(t).length>0?e.stripeService.elements(t):e.stripeService.elements()}))),n={};r.combineLatest(t,this.options$.asObservable().pipe(o.filter((function(e){return Boolean(e)})))).subscribe((function(t){var r,o,s=u(t,2),p=s[0],a=s[1];if(e.elements=[],e.card){var l=function(t){var r,o=p.create(t,a);n=i({},n,((r={})[t]=o,r)),-1!==["card","cardNumber"].indexOf(t)&&(e.cardElement=o);var s=e.card.nativeElement.querySelector("."+t);o.mount(s),o.on("change",(function(t){var r=t.complete;for(var i in n)if(n){var s=n[i];i===t.elementType||s._complete||(r=!1)}e.change.emit({card:t,elements:e.elements,type:t.elementType,complete:r,element:o}),r&&e.complete.emit({card:t,elements:e.elements,type:t.elementType,complete:r,element:o}),t.error&&e.error.emit(t.error)})),e.elements=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(u(arguments[t]));return e}(e.elements,[o])};try{for(var d=c(e.elementTypes),f=d.next();!f.done;f=d.next()){l(f.value)}}catch(e){r={error:e}}finally{try{f&&!f.done&&(o=d.return)&&o.call(d)}finally{if(r)throw r.error}}}}))},e.prototype.getCard=function(){return this.cardElement},e.ctorParameters=function(){return[{type:S}]},s([t.Input(),a("design:type",Object),a("design:paramtypes",[Object])],e.prototype,"options",null),s([t.Input(),a("design:type",Object),a("design:paramtypes",[Object])],e.prototype,"elementsOptions",null),s([t.Output(),a("design:type",Object)],e.prototype,"change",void 0),s([t.Output(),a("design:type",Object)],e.prototype,"complete",void 0),s([t.Output(),a("design:type",Object)],e.prototype,"error",void 0),s([t.Input(),a("design:type",Array)],e.prototype,"elementTypes",void 0),s([t.ViewChild("card",{static:!1}),a("design:type",t.ElementRef)],e.prototype,"card",void 0),e=s([t.Component({selector:"ngx-stripe-card",template:'\n    <div class="field" #card>\n      <div [class]="type" *ngFor="let type of elementTypes"></div>\n    </div>\n  '}),a("design:paramtypes",[S])],e)}(),I=function(){function e(){}var r;return r=e,e.forRoot=function(e,t){return{ngModule:r,providers:[j,S,v,O,b,{provide:d,useValue:e},{provide:f,useValue:t}]}},e=r=s([t.NgModule({imports:[n.CommonModule],declarations:[P,w],exports:[P,w]})],e)}();e.DocumentRef=b,e.LazyStripeAPILoader=j,e.NgxStripeModule=I,e.PlatformService=v,e.STRIPE_OPTIONS=f,e.STRIPE_PUBLISHABLE_KEY=d,e.StripeCardComponent=P,e.StripeService=S,e.WindowRef=O,e.isBankAccount=m,e.isBankAccountData=y,e.isPii=h,e.isPiiData=g,e.isSourceData=l,e.ɵa=w,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=nomadreservations-ngx-stripe.umd.min.js.map